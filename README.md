# Redis_Test

# Установка WSL и Redis

1. Установить WSL для работы с Redis на Windows
``` bash
wsl --install
```
2. Далее ввести эти команды:
```bash
curl -fsSL https://packages.redis.io/gpg | sudo gpg --dearmor -o /usr/share/keyrings/redis-archive-keyring.gpg

echo "deb [signed-by=/usr/share/keyrings/redis-archive-keyring.gpg] https://packages.redis.io/deb $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/redis.list

sudo apt-get update
sudo apt-get install redis
```
3. Запускаем такой командой:
```bash
sudo service redis-server start
```

# Запуск проекта
1. Если нет файла appsettings.Development.json - добавить с такой конфигурацией
```json
{
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Port=5432;Database=Redis_Test;User Id=postgres;Password=admin"
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.EntityFrameworkCore.Database": "Information"
    }
  }
}
```
2. При запуске проекта будет запущен сам проект и развернута БД PostgreSQL.

# Проверка работы
1. В Postman вбиваем команду `GET` по адресу
`https://localhost:xxxx/user/1`

Вместо `xxxx` вставить свой порт, у меня `7181`.

# Остановка процессов
1. Выполнить команду 
```bash 
sudo service redis-server stop
```
 чтобы корректно завершить работу Redis.
Или принудительно командой 
```bash 
sudo killall redis-server
```


# Дополнительная информация.
1. Проект сделан на .Net 9
2. Используется БД PostgreSQL
3. Добавлены миграции

# Вывод консоли должен быть в таком виде:
```bash
warn: Microsoft.EntityFrameworkCore.Model[10632]
      No instantiatable types implementing `IEntityTypeConfiguration` were found while while scanning assembly 'Redis_Test, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null'.
warn: Microsoft.EntityFrameworkCore.Model.Validation[10400]
      Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (421ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE DATABASE "Redis_Test";
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (6ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE "Users" (
          "Id" integer GENERATED BY DEFAULT AS IDENTITY,
          "Name" text NOT NULL,
          "Age" integer NOT NULL,
          CONSTRAINT "PK_Users" PRIMARY KEY ("Id")
      );
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (5ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      INSERT INTO "Users" ("Id", "Age", "Name")
      VALUES (1, 23, 'Tom');
      INSERT INTO "Users" ("Id", "Age", "Name")
      VALUES (2, 26, 'Alice');
      INSERT INTO "Users" ("Id", "Age", "Name")
      VALUES (3, 28, 'Sam');
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT setval(
    pg_get_serial_sequence('"Users"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "Users") + 1,
        nextval(pg_get_serial_sequence('"Users"', 'Id'))),
    false);
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (30ms) [Parameters=[@__p_0='1'], CommandType='Text', CommandTimeout='30']
      SELECT u."Id", u."Age", u."Name"
      FROM "Users" AS u
      WHERE u."Id" = @__p_0
      LIMIT 1
Tom извлечен из базы данных
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT CASE WHEN COUNT(*) = 0 THEN FALSE ELSE TRUE END
FROM pg_class AS cls
JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
WHERE
        cls.relkind IN ('r', 'v', 'm', 'f', 'p') AND
        ns.nspname NOT IN ('pg_catalog', 'information_schema') AND
        -- Exclude tables which are members of PG extensions
        NOT EXISTS (
            SELECT 1 FROM pg_depend WHERE
                classid=(
                    SELECT cls.oid
                    FROM pg_class AS cls
                             JOIN pg_namespace AS ns ON ns.oid = cls.relnamespace
                    WHERE relname='pg_class' AND ns.nspname='pg_catalog'
                ) AND
                objid=cls.oid AND
                deptype IN ('e', 'x')
        )
Tom извлечен из кэша
```